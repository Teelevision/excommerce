/*
 * ExCommerce
 *
 * ExCommerce is an example commerce system.
 *
 * API version: beta
 * Generated by: OpenAPI Generator (https://openapi-generator.tech)
 */

package main

import (
	"log"
	"net/http"

	"github.com/Teelevision/excommerce/controller"
	openapi "github.com/Teelevision/excommerce/go"
	"github.com/Teelevision/excommerce/persistence/inmemory"
)

func main() {
	log.Printf("Server started")

	// persistence
	repo := inmemory.NewAdapter()

	// controllers
	createUserController := controller.CreateUser{UserRepository: repo}
	getUserController := controller.GetUser{UserRepository: repo}

	// api
	CartsAPIService := openapi.NewCartsAPIService()
	cartsAPI := openapi.NewCartsAPI(CartsAPIService)

	OrdersAPIService := openapi.NewOrdersAPIService()
	ordersAPI := openapi.NewOrdersAPI(OrdersAPIService)

	ProductsAPIService := openapi.NewProductsAPIService()
	productsAPI := openapi.NewProductsAPI(ProductsAPIService)

	usersAPI := &openapi.UsersAPI{
		CreateUserController: &createUserController,
		GetUserController:    &getUserController,
	}

	router := openapi.NewRouter(cartsAPI, ordersAPI, productsAPI, usersAPI)

	log.Fatal(http.ListenAndServe(":8080", router))
}
